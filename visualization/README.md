# 气体管网多变量时间序列可视化器

用于气体管道网络仿真数据的多变量对比可视化工具。

## 启动应用

```bash
streamlit run visualization/multi_variable_viewer.py
```

## 新功能特性

### 🎯 通配符批量添加变量
- **功能描述**: 使用通配符模式（如 `N_005*`）一次性添加多个相关变量
- **使用场景**: 快速查看某个设备（如 N_005）的所有参数变化
- **操作步骤**:
  1. 在侧边栏选择"批量数据集"
  2. 在"通配符模式"输入框中输入模式（如 `N_005*`）
  3. 系统会自动显示匹配的变量预览
  4. 点击"➕ 批量添加这些变量"按钮
  5. 系统自动创建多个变量选择行，每个匹配的变量一行

### 🎨 自动颜色分配
- 不同变量自动分配不同颜色
- 使用 Plotly 的 Set3 调色板确保视觉区分度

### 📊 设备类型分类显示
支持按设备类型自动分类显示：
- B (球阀/Ball Valves)
- C (压缩机/Compressors) 
- H (管段/Pipeline Segments)
- N (节点/Nodes)
- P (管道/Pipelines)
- R (调节阀/Control Valves)
- T (气源/Gas Sources)
- E (分输点/Distribution Points)

### 🔍 正则表达式过滤
- 支持使用正则表达式过滤变量名
- 例如：`p_in|p_out` 匹配所有压力变量
- 例如：`^B_` 匹配所有以B_开头的变量

## 测试验证

✅ 已通过 Playwright 自动化测试：
- 应用启动正常
- 数据集加载正常（264个数据集）
- 通配符功能正常工作
- 批量添加功能成功添加多个变量
- 支持4个以上变量同时显示和对比

## 性能优化

✅ 解决了 DataFrame 碎片化警告：
- 使用 `pd.concat(axis=1)` 替代多次 `frame.insert` 操作
- 提高了数据处理性能

## 使用示例

### 批量添加节点变量
1. 选择数据集："第001个算例"
2. 输入通配符：`N_005*`
3. 系统找到匹配变量：N_005_p, N_005_q, N_005_t
4. 点击批量添加，自动创建3个变量选择行

### 压力变量筛选
1. 在正则表达式过滤框输入：`.*p_in.*|.*p_out.*`
2. 系统自动过滤显示所有压力相关变量

## 数据支持

- **时间窗口**: 固定为2025年1月1日0点到24点
- **数据格式**: 支持边界条件和设备参数数据
- **变量类型**: 压力(p)、流量(q)、温度(t)、管存(inv)、功率(pwr)等

## 技术实现

- **前端框架**: Streamlit
- **图表库**: Plotly
- **数据处理**: Pandas
- **模式匹配**: Python re 模块
- **缓存优化**: Streamlit @st.cache_data 装饰器